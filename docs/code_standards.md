# Prompt Factory 代码规范

## 1. 代码风格

### 1.1 Python 风格

- 遵循 [PEP 8](https://www.python.org/dev/peps/pep-0008/)
- 缩进使用 4 空格（禁用 Tab）
- 每行不超过 100 字符
- 类名采用 CamelCase，函数和变量用 snake_case
- 常量全大写加下划线（如 `MAX_TOKENS`）

### 1.2 注释规范

- 公共函数、方法和类需有文档字符串（docstring）
- 采用 Google 风格文档字符串：

```python
def function_name(param1, param2):
    """
    函数简述
    
    详细描述（可选）
    
    Args:
        param1: 参数1描述
        param2: 参数2描述
        
    Returns:
        返回值描述
        
    Raises:
        ExceptionType: 异常描述
    """
```

- 复杂逻辑加行内注释说明意图
- 待完成功能用 TODO 注释，格式 `# TODO: 描述`

## 2. 文件组织

### 2.1 模块划分

- 遵循单一职责原则，每个模块专注一个功能
- 相关功能归于同一模块
- 模块间通过明确接口交互，避免循环依赖

### 2.2 目录结构

```
prompt_factory/
├── docs/                  # 文档
├── templates/             # 模板
├── tests/                 # 测试
├── src/                   # 源码
│   ├── api/               # API接口
│   ├── core/              # 核心功能
│   ├── utils/             # 工具
│   └── web/               # Web界面
├── config.py              # 配置
├── model_manager.py       # 模型
├── prompt_processor.py    # 提示词处理
└── template_manager.py    # 模板管理
```

## 3. 前后端分离

### 3.1 后端原则

- 采用 RESTful API 风格
- 明确数据模型和接口规范
- 封装核心功能，提供稳定 API
- 完善错误处理和日志
- 敏感信息使用环境变量或配置管理

### 3.2 API设计规范

- HTTP 方法对应操作：
  - GET: 获取
  - POST: 创建
  - PUT: 更新
  - DELETE: 删除

- URL 用名词命名：
  - `/api/templates` 而非 `/api/getTemplates`
  - `/api/models/openai` 而非 `/api/listOpenAiModels`

- 使用 HTTP 状态码反馈结果
- 响应统一 JSON 格式，含状态、数据和消息

```json
{
  "status": "success",  // 或 "error"
  "data": {},          // 响应数据
  "message": ""        // 可选的消息
}
```

### 3.3 前端设计原则

- 组件化开发，遵循单一职责原则
- 使用现代前端框架（如 React、Vue）
- 状态管理清晰（如 Redux、Vuex）
- 响应式设计，支持多种设备
- 统一的错误处理和用户通知机制

### 3.4 可视化界面设计规范

#### 3.4.1 布局与交互

- 采用模块化布局，确保各功能区块清晰分离
- 提供直观的导航和操作流程
- 实现渐进式展示复杂功能，避免界面过载
- 对关键操作提供即时反馈
- 确保所有交互元素有足够的点击/触摸区域

#### 3.4.2 可视化组件

- 使用统一的设计语言和视觉风格
- 为提示词模板提供可视化预览功能
- 模型参数调整应提供适当的可视化控件（如滑块、开关等）
- 处理结果展示应支持对比视图
- 使用适当的数据可视化图表展示批处理统计数据

#### 3.4.3 前后端数据交互

- 严格遵循已定义的API接口规范
- 实现数据加载状态的可视化反馈
- 针对耗时操作实现进度指示器
- 所有表单提交前进行客户端数据验证
- 实现优雅的错误处理和用户通知机制
- 使用WebSocket或长轮询技术实现批处理任务的实时进度更新

## 4. 错误处理规范

### 4.1 异常处理

- 使用特定的异常类型而非通用 Exception
- 记录详细的错误信息，包括堆栈跟踪
- 在适当的层级处理异常，避免异常穿透

### 4.2 用户反馈

- 为用户提供清晰、友好的错误消息
- 区分用户错误和系统错误的处理方式
- 提供有用的故障排除建议

## 5. 测试规范

### 5.1 单元测试

- 使用 pytest 或 unittest 框架
- 为所有公共函数和方法编写测试
- 测试应覆盖正常流程和异常情况
- 模拟外部依赖，避免实际 API 调用

### 5.2 集成测试

- 测试模块之间的交互
- 验证 API 的功能和性能
- 使用测试环境配置，避免污染生产数据

## 6. 版本控制和发布

### 6.1 Git 工作流

- 主分支（main）保持稳定，随时可发布
- 使用功能分支（feature branches）开发新功能
- 提交消息清晰描述变更内容
- 代码审查后才能合并到主分支

### 6.2 语义化版本

遵循语义化版本规范（[SemVer](https://semver.org/)）：

- 主版本号（X.0.0）：不向后兼容的变更
- 次版本号（0.X.0）：向后兼容的功能新增
- 修订号（0.0.X）：向后兼容的问题修正